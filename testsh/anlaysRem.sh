#!/bin/bash

echo "🏥 医学图像标注系统配置需求分析"
echo "================================"

cd /home/droot/medc-img-annotation-app/testsh

# 运行配置分析
python memAnaly.py > 医学图像标注系统配置需求报告.json

echo ""
echo "📋 生成验收说明文档..."

cat > 配置需求说明.md << 'EOF'
# 医学图像标注系统配置需求说明

## 当前状况 vs 生产需求

### 演示环境 (2核2GB)
- ✅ 适用于功能演示和验收
- ✅ 可以展示所有核心功能
- ⚠️ 仅支持1-2个用户同时使用

### 生产环境需求 (4核16GB)

#### 1. 并发用户支持
- 医院实际使用：8-10个医生同时标注
- 每个医生会话内存需求：150MB
- 峰值总内存：1.5GB × 8 = 12GB

#### 2. 医学图像特殊需求
- DICOM文件大小：50-200MB
- 图像处理内存放大：3倍
- 多层序列加载：额外2.5倍内存

#### 3. 系统稳定性要求
- 医疗系统不允许频繁卡顿
- 需要40%内存安全边际
- CPU保持70%以下使用率

#### 4. 具体计算
```
基础内存需求：8用户 × 150MB = 1.2GB
图像处理内存：8用户 × 200MB × 3 = 4.8GB  
系统缓存：2GB
安全边际：40% = 3.2GB
总计：≈ 12GB → 推荐16GB
```

## 结论
- **验收阶段**：2核2GB足够演示
- **正式部署**：必须升级到4核16GB
- **原因**：并发需求 + 医学图像处理 + 系统稳定性
EOF

echo "✅ 分析完成！生成的文件："
echo "   - 医学图像标注系统配置需求报告.json"
echo "   - 配置需求说明.md"